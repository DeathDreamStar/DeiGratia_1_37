########################################
# Passive effects events
#
# scripted by Ogulcan Yildirim
########################################

namespace = passive_effects_events
	
# Increase the opinion of all Christians / Muslims if picked the diplomatic rabbi aspect
country_event = {
	id = passive_effects_events.4
	title = none
	desc = none
	picture = none
	hidden = yes

	trigger = {
		has_church_aspect = judaism_diplomatic_rabbi_aspect
		any_known_country = {
			OR = {
				religion_group = muslim
				religion_group = christian
			}
			NOT = { government = theocracy }
			NOT = {
				has_opinion_modifier = {
					who = ROOT
					modifier = diplomatic_rabbi_opinion
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 1
	}
	
	option = { 
		every_known_country = {
			limit = {
				OR = {
					religion_group = muslim
					religion_group = christian
				}
				NOT = { government = theocracy }
				NOT = {
					has_opinion_modifier = {
						who = ROOT
						modifier = diplomatic_rabbi_opinion
					}
				}
			}
			add_opinion = {
				who = ROOT
				modifier = diplomatic_rabbi_opinion
			}
			reverse_add_opinion = {
				who = ROOT
				modifier = diplomatic_rabbi_opinion_reverse
			}
		}
		
		ai_chance = {
			factor = 1
		}
	}
}
	
# Remove opinion when aspect gets removed
country_event = {
	id = passive_effects_events.5
	title = none
	desc = none
	picture = none
	hidden = yes

	trigger = {
		NOT = { has_church_aspect = judaism_diplomatic_rabbi_aspect }
		any_known_country = {
			has_opinion_modifier = {
				who = ROOT
				modifier = diplomatic_rabbi_opinion
			}
		}
	}

	mean_time_to_happen = {
		months = 1
	}
	
	option = {
		every_country = {
			limit = {
				has_opinion_modifier = {
					who = ROOT
					modifier = diplomatic_rabbi_opinion
				}
			}
			remove_opinion = {
				who = ROOT
				modifier = diplomatic_rabbi_opinion
			}
			reverse_remove_opinion = {
				who = ROOT
				modifier = diplomatic_rabbi_opinion_reverse
			}
		}
		
		ai_chance = {
			factor = 1
		}
	}
}	

# Add siege progress when retaking own fort
country_event = {
	id = passive_effects_events.7
	title = none
	desc = none
	picture = none
	hidden = yes

	trigger = {
		religion = jewish
		has_church_aspect = judaism_remember_passover_aspect
		any_owned_province = {
			NOT = { controlled_by = ROOT }
			OR = {
				has_building = fort_15th
				has_building = fort_16th
				has_building = fort_17th
				has_building = fort_18th
				is_capital = yes
				has_building = native_palisade
			}
			NOT = { has_province_flag = getting_retaken_by_owner }
			sieged_by = ROOT
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		every_owned_province = {
			limit = {
				NOT = { controlled_by = ROOT }
				OR = {
					has_building = fort_15th
					has_building = fort_16th
					has_building = fort_17th
					has_building = fort_18th
					is_capital = yes
					has_building = native_palisade
				}
				NOT = { has_province_flag = getting_retaken_by_owner }
				sieged_by = ROOT
			}
			change_siege = 2
			set_province_flag = getting_retaken_by_owner
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Remove siege progress when aspect gets removed
country_event = {
	id = passive_effects_events.8
	title = none
	desc = none
	picture = none
	hidden = yes

	trigger = {
		any_owned_province = {
			has_province_flag = getting_retaken_by_owner
			OR = {
				owner = {
					OR = {
						NOT = { religion = jewish }
						NOT = { has_church_aspect = judaism_remember_passover_aspect }
					}
				}
				has_siege = no
			}
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		every_owned_province = {
			limit = {
				has_province_flag = getting_retaken_by_owner
				has_siege = no
			}
			clr_province_flag = getting_retaken_by_owner
		}

		ai_chance = {
			factor = 1
		}
	}
}

# Remove the unrest from seizure estate land
province_event = {
	id = passive_effects_events.9
	title = none
	desc = none
	picture = none
	hidden = yes

	trigger = {
		had_province_flag = {
			flag = has_estate_unrest_flag
			days = 3650
		}
	}

	mean_time_to_happen = {
		days = 5
	}

	option = {
		clr_province_flag = has_estate_unrest_flag
		remove_named_unrest = estate_land_seized

		ai_chance = {
			factor = 1
		}
	}
}