namespace = ipe_institutions

########################################
# Banking
########################################

# The Advent of Banking
country_event = {
	id = ipe_institutions.1
	title = ipe_institutions.1.t
	desc = ipe_institutions.1.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes

	trigger = {
		always = yes
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = institution_events.2.a
		add_adm_power = 100
		add_dip_power = 100
		add_mil_power = 100
		add_prestige = 20
		if = {
			limit = {
				NOT = { has_completed_all_reforms_trigger = yes }
			}
			add_reform_progress_medium_effect = yes
		}
		custom_tooltip = ipe_institutions.1.a.tooltip
		FROM = {
			add_permanent_province_modifier = {
				name = "birthplace_of_banking"
				duration = -1
			}
		}
		hidden_effect = {
			every_country = {
				limit = {
					ai = no
					NOT = { tag = ROOT }
					knows_country = ROOT
				}
				country_event = { id = ipe_institutions.2 }
			}
			every_country = {
				limit = {
					ai = no
					NOT = { tag = ROOT }
					NOT = { knows_country = ROOT }
				}
				country_event = { id = ipe_institutions.3 }
			}
		}
	}
}

country_event = { # The Advent of Banking
	id = ipe_institutions.2
	title = ipe_institutions.1.t
	desc = ipe_institutions.1.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes
	

	trigger = {
		always = yes
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = institution_events.2.a
		custom_tooltip = ipe_institutions.1.a.tooltip
	}
}

country_event = {
	id = ipe_institutions.3
	title = ipe_institutions.1.t
	desc = ipe_institutions.3.d
	picture = ECONOMY_eventPicture

	is_triggered_only = yes

	trigger = {
		always = no
	}

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = institution_events.2.a
		custom_tooltip = ipe_institutions.1.a.tooltip
	}
}

########################################
# Print Culture
########################################

# Opposition to the Printing Press
country_event = {
	id = ipe_institutions.4
	title = ipe_institutions.4.t
	desc = ipe_institutions.4.d
	picture = CHURCH_ESTATE_2_eventPicture

	trigger = {
		religion_group = muslim
		OR = {
			any_owned_province = {
				printing_press = 100
				any_neighbor_province = {
					printing_press = 100
				}
			}
		}
		NOT = {
			has_institution = printing_press
			has_country_flag = muslim_printing_press
			any_owned_province = {
				is_institution_origin = printing_press
			}
		}
	}

	mean_time_to_happen = {
		months = 120
		modifier = {
			factor = 0.5
			government = theocracy
		}
		modifier = {
			factor = 0.5
			estate_influence = {
				estate = estate_church
				influence = 60
			}
		}
		modifier = {
			factor = 0.5
			estate_influence = {
				estate = estate_church
				influence = 80
			}
		}
		modifier = {
			factor = 0.5
			estate_influence = {
				estate = estate_church
				influence = 100
			}
		}
	}

	immediate = {
		set_country_flag = muslim_printing_press
	}

	option = { # The word of God should not be surrendered to machines.
		name = ipe_institutions.4.a
		ai_chance = {
			factor = 80
			modifier = {
				factor = 100
				government = theocracy
			}
			modifier = {
				factor = 0
				has_idea_group = innovativeness_ideas
			}
		}
		custom_tooltip = ipe_institutions.4.a.tooltip
		add_stability = 1
		add_country_modifier = {
			name = banned_printing_press
			duration = -1
		}
		add_estate_loyalty = {
			estate = estate_church
			loyalty = 10
		}
		add_estate_influence_modifier = {
			estate = estate_church
			desc = church_banned_the_printing_press
			influence = 30
			duration = 18250
		}
		add_piety = 0.25
		every_owned_province = {
			limit = {
				religion_group = muslim
				NOT = {
					printing_press = 100
				}
			}
			add_institution_embracement = {
				which = printing_press
				value = -50
			}
		}
	}

	option = { # There is no better way to spread God's word.
		name = ipe_institutions.4.b
		ai_chance = {
			factor = 20
			modifier = {
				factor = 0
				government = theocracy
			}
			modifier = {
				factor = 100
				has_idea_group = innovativeness_ideas
			}
		}
		add_country_modifier = {
			name = accepted_printing_press
			duration = 9125
		}
		if = {
			limit = {
				government = theocracy
			}
			add_stability = -6
		}
		if = {
			limit = {
				NOT = {
					government = theocracy
				}
			}
			add_stability = -3
		}
		add_estate_loyalty = {
			estate = estate_church
			loyalty = -30
		}
		add_estate_influence_modifier = {
			estate = estate_church
			desc = church_refused_to_ban_the_printing_press
			influence = -10
			duration = 18250
		}
		add_piety = -0.25
		if = {
			limit = {
				religion = sunni
			}
			capital_scope = {
				spawn_rebels = {
					size = 1
					type = sunni_rebels
				}
			}
			random_owned_province = {
				limit = {
					is_capital = no
				}
				spawn_rebels = {
					size = 1
					type = sunni_rebels
				}
			}
		}
		if = {
			limit = {
				religion = shiite
			}
			capital_scope = {
				spawn_rebels = {
					size = 1
					type = shiite_rebels
				}
			}
			random_owned_province = {
				limit = {
					is_capital = no
				}
				spawn_rebels = {
					size = 1
					type = shiite_rebels
				}
			}
		}
		if = {
			limit = {
				religion = ibadi
			}
			capital_scope = {
				spawn_rebels = {
					size = 1
					type = ibadi_rebels
				}
			}
			random_owned_province = {
				limit = {
					is_capital = no
				}
				spawn_rebels = {
					size = 1
					type = ibadi_rebels
				}
			}
		}
	}
}

# Discontented Scribes
country_event = {
	id = ipe_institutions.5
	title = ipe_institutions.5.t
	desc = ipe_institutions.5.d
	picture = CHURCH_ESTATE_2_eventPicture

	trigger = {
		has_country_modifier = accepted_printing_press
		religion_group = muslim
		any_owned_province = {
			printing_press = 50
			NOT = {
				printing_press = 100
			}
		}
		NOT = {
			has_institution = printing_press
		}
	}

	mean_time_to_happen = {
		months = 120
		modifier = {
			factor = 0.5
			NOT = {
				estate_loyalty = {
					estate = estate_church
					loyalty = 60
				}
			}
		}
		modifier = {
			factor = 0.5
			NOT = {
				estate_loyalty = {
					estate = estate_church
					loyalty = 30
				}
			}
		}
	}

	option = { # Appease the scribes.
		name = ipe_institutions.5.a
		ai_chance = {
			factor = 20
		}
		add_piety = -0.1
		random_owned_province = {
			limit = {
				printing_press = 50
				NOT = {
					printing_press = 100
				}
			}
			add_institution_embracement = {
				which = printing_press
				value = -50
			}
		}
	}

	option = { # Offer no recourse.
		name = ipe_institutions.5.b
		ai_chance = {
			factor = 80
		}
		add_piety = -0.1
		add_adm_power = -50
		add_estate_loyalty = {
			estate = estate_church
			loyalty = -10
		}
		if = {
			limit = {
				religion = sunni
			}
			random = {
				chance = 50
				random_owned_province = {
					limit = {
						printing_press = 50
						NOT = {
							printing_press = 100
						}
					}
					spawn_rebels = {
						size = 1
						type = sunni_rebels
					}
				}
			}
		}
		if = {
			limit = {
				religion = shiite
			}
			random = {
				chance = 50
				random_owned_province = {
					limit = {
						printing_press = 50
						NOT = {
							printing_press = 100
						}
					}
					spawn_rebels = {
						size = 1
						type = shiite_rebels
					}
				}
			}
		}
		if = {
			limit = {
				religion = ibadi
			}
			random = {
				chance = 50
				random_owned_province = {
					limit = {
						printing_press = 50
						NOT = {
							printing_press = 100
						}
					}
					spawn_rebels = {
						size = 1
						type = ibadi_rebels
					}
				}
			}
		}
	}
}

# Dhimmi Printing
country_event = {
	id = ipe_institutions.6
	title = ipe_institutions.6.t
	desc = ipe_institutions.6.d
	picture = DHIMMI_ESTATE_eventPicture

	trigger = {
		has_country_modifier = banned_printing_press
		religion_group = muslim
		any_owned_province = {
			NOT = {
				religion_group = muslim
			}
			printing_press = 50
			NOT = {
				printing_press = 100
			}
		}
		NOT = {
			has_institution = printing_press
		}
	}

	mean_time_to_happen = {
		months = 600
	}

	option = { # Allow non-Muslims to continue printing books in their native languages.
		name = ipe_institutions.6.a
		ai_chance = {
			factor = 80
			modifier = {
				factor = 0
				government = theocracy
			}
		}
		add_estate_loyalty = {
			estate = estate_dhimmi
			loyalty = 10
		}
		add_estate_loyalty = {
			estate = estate_church
			loyalty = -10
		}
		add_piety = -0.1
	}

	option = { # There must be uniformity in our realm.
		name = ipe_institutions.6.b
		ai_chance = {
			factor = 20
			modifier = {
				factor = 100
				government = theocracy
			}
		}
		add_stability = 1
		add_estate_loyalty = {
			estate = estate_church
			loyalty = 20
		}
		add_estate_loyalty = {
			estate = estate_dhimmi
			loyalty = -20
		}
		add_piety = 0.1
		every_owned_province = {
			limit = {
				NOT = {
					religion_group = muslim
				}
				printing_press = 50
				NOT = {
					printing_press = 100
				}
			}
			add_institution_embracement = {
				which = printing_press
				value = -50
			}
		}
	}
}

# The Ban on the Printing Press
country_event = {
	id = ipe_institutions.7
	title = ipe_institutions.7.t
	desc = ipe_institutions.7.d
	picture = PRINTING_PRESS_eventPicture

	trigger = {
		has_country_modifier = banned_printing_press
	}

	mean_time_to_happen = {
		months = 3600
		modifier = {
			factor = 0.025
			has_institution = printing_press
		}
		modifier = {
			factor = 0.1
			is_year = 1700
		}
		modifier = {
			factor = 0.5
			full_idea_group = innovativeness_ideas
		}
	}

	option = { # We must catch up with the West.
		name = ipe_institutions.7.a
		remove_country_modifier = banned_printing_press
		add_piety = -0.1
	}
}