namespace = ipeQAR
normal_or_historical_nations = yes

# Pirbudag's Ambition
country_event = {
	id = ipeQAR.1
	title = ipeQAR.1.t
	desc = ipeQAR.1.d
	picture = CIVIL_WAR_eventPicture

	fire_only_once = yes

	trigger = {
		tag = QAR
		IRQ = {
			is_subject_of = QAR
		}
	}

	mean_time_to_happen = {
		months = 60
	}

	option = { # Allow Pirbudag to rule in Baghdad.
		name = ipeQAR.1.a
		ai_chance = {
			factor = 75
		}
		IRQ = {
			tooltip = {
				define_heir = {
					name = "Pirbudag"
					dynasty = "Qara Qoyunlu"
					culture = "azerbaijani"
					claim = 30
					age = 20
					adm = 1
					dip = 2
					mil = 1
				}
				kill_ruler = yes
			}
			if = {
				limit = {
					has_dlc = "Rights of Man"
				}
				hidden_effect = { add_ruler_personality = naive_personality }
			}
			set_country_flag = rise_of_pirbudag
			hidden_effect = {
				country_event = {
					id = ipeQAR.4
					days = 1
				}
			}
		}
	}

	option = { # I will not tolerate insolent children.
		name = ipeQAR.1.b
		ai_chance = {
			factor = 25
		}
		random_owned_province = {
			spawn_rebels = {
				type = pretender_rebels
				size = 1
				leader = "Pirbudag"
				leader_dynasty = "Qara Qoyunlu"
			}
		}
	}
}

# The Armies of Uzun Hasan
country_event = {
	id = ipeQAR.2
	title = ipeQAR.2.t
	desc = ipeQAR.2.d
	picture = GOOD_WITH_MONARCH_eventPicture

	fire_only_once = yes

	trigger = {
		tag = AKK
		OR = {
			has_ruler = "Uzun Hasan"
			has_heir = "Uzun Hasan"
			NOT = {
				has_leader = "Uzun Hasan"
			}
		}
	}

	mean_time_to_happen = {
		months = 1
	}

	option = { # Allow Uzun Hasan to lead the armies.
		name = ipeQAR.2.a
		ai_chance = {
			factor = 100
		}
		if = {
			limit = {
				has_heir = "Uzun Hasan"
			}
			define_heir_to_general = {
				fire = 4
				shock = 5
				manuever = 5
				siege = 0
			}
		}
		if = {
			limit = {
				has_ruler = "Uzun Hasan"
			}
			# define_ruler_to_general = {
			#	fire = 4
			#	shock = 5
			#	manuever = 5
			#	siege = 0
			# }
		}
	}

	option = { # There is no need for him to endanger himself.
		name = ipeQAR.2.b
		ai_chance = {
			factor = 0
		}
		add_heir_claim = -10
	}
}

# Pirbudag Claims the Throne!
country_event = {
	id = ipeQAR.3
	title = ipeQAR.3.t
	desc = ipeQAR.3.d
	picture = ACCUSATION_eventPicture

	fire_only_once = yes

	trigger = {
		tag = QAR
		IRQ = {
			is_subject_of = QAR
			has_ruler = "Pirbudag"
			dynasty = "Qara Qoyunlu"
			has_country_flag = rise_of_pirbudag
		}
	}

	mean_time_to_happen = {
		months = 60
	}

	option = { # The audacity!
		name = ipeQAR.3.a
		IRQ = {
			clr_country_flag = rise_of_pirbudag
			custom_tooltip = ipeQAR.3.a.tooltip
			hidden_effect = {
				QAR = {
					every_owned_province = {
						add_core = IRQ
					}
				}
			}
			add_liberty_desire = 100
			hidden_effect = {
				country_event = {
					id = ipeQAR.5
					days = 1
				}
			}
		}
	}
}

# The Arrival of Pirbudag
country_event = {
	id = ipeQAR.4
	title = ipeQAR.4.t
	desc = ipeQAR.4.d
	picture = ACCUSATION_eventPicture

	is_triggered_only = yes

	option = { # He is not welcome here.
		name = ipeQAR.4.a
		define_heir = {
			name = "Pirbudag"
			dynasty = "Qara Qoyunlu"
			culture = "azerbaijani"
			claim = 30
			age = 20
			adm = 1
			dip = 2
			mil = 1
		}
		kill_ruler = yes
		random_owned_province = {
			spawn_rebels = {
				type = noble_rebels
				size = 1
			}
		}
	}
}

# Pirbudag's Ambition
country_event = {
	id = ipeQAR.5
	title = ipeQAR.1.t
	desc = ipeQAR.5.d
	picture = ACCUSATION_eventPicture

	is_triggered_only = yes

	option = { # We will pursue Pirbudag's ambition!
		name = ipeQAR.5.a
		tooltip = {
			QAR = {
				every_owned_province = {
					add_core = IRQ
				}
			}
			add_liberty_desire = 100
		}
	}
}

# Death of Shah Rukh
country_event = {
	id = ipeQAR.6
	title = ipeQAR.6.t
	desc = ipeQAR.6.d
	picture = DEATH_OF_HEIR_eventPicture

	is_triggered_only = yes

	option = { # Timur's legacy belongs to us!
		name = ipeQAR.6.a
		if = {
			limit = {
				is_subject_of = FROM
			}
			tooltip = {
				grant_independence = yes
			}
		}
		persia_region = {
			limit = {
				NOT = {
					is_core = ROOT
				}
				NOT = {
					is_permanent_claim = ROOT
				}
			}
			add_permanent_claim = ROOT
		}
	}
}